# Caltech-101 图像分类实验详细报告

## 1. 实验概述

### 1.1 实验目的
本实验旨在通过微调在ImageNet上预训练的卷积神经网络，实现对Caltech-101数据集的图像分类，并观察不同超参数设置和预训练策略对模型性能的影响。

### 1.2 数据集信息
- **数据集名称**: Caltech-101
- **总样本数**: 8677
- **类别数量**: 101
- **最少样本类别**: inline_skate (31个样本)
- **最多样本类别**: airplanes (800个样本)
- **平均每类样本数**: 85.9
- **训练样本总数**: 3030 (每类前30个样本)
- **验证样本总数**: 606 (从训练集中分出20%)
- **测试样本总数**: 5647 (每类剩余样本)

## 2. 详细实验设置

### 2.1 数据划分策略
- **训练集**: 每类前30个样本，共3030个样本
- **验证集**: 从训练集中分出20%，共606个样本
- **测试集**: 每类剩余样本，共5647个样本

### 2.2 数据预处理设置
- **图像尺寸**: 224×224像素
- **标准化**: ImageNet标准 (mean=[0.485, 0.456, 0.406], std=[0.229, 0.224, 0.225])
- **数据增强**: 随机水平翻转、随机旋转(±15°)、颜色抖动、随机裁剪
- **训练/验证/测试划分**: 按Caltech-101标准，每类30个训练样本

### 2.3 训练配置
- **损失函数**: CrossEntropyLoss
- **优化器**: Adam
- **权重衰减**: 1e-4
- **批大小**: 32
- **早停策略**: 验证准确率10轮不提升则停止
- **设备**: 自动检测CUDA/CPU

### 2.4 完整实验配置表

| 实验名称 | 模型 | 预训练 | 冻结特征 | 学习率 | 批大小 | 计划轮数 | 实际轮数 | 学习率调度 | 步长 | 衰减率 |
|:---------|:-----|:-------|:---------|:-------|:-------|:---------|:---------|:-----------|:-----|:-------|
| 预训练微调 | ResNet-18 | True | False | 0.001 | 32 | 3 | 3 | step | 2 | 0.1 |
| 从头训练 | ResNet-18 | False | False | 0.01 | 32 | 100 | 100 | step | 30 | 0.1 |

## 3. 实验结果汇总

### 3.1 定量结果表格

| 模型 | 实验设置 | 验证准确率(%) | 测试准确率(%) | 训练时间(分钟) | 预训练 | 学习率 | 训练轮数 |
|:-----|:---------|:--------------|:--------------|:---------------|:-------|:-------|:---------|
| ResNet-18 | 预训练微调 | 92.74 | 91.06 | 6 | True | 0.001 | 3 |
| ResNet-18 | 从头训练 | 39.27 | 38.20 | 200 | False | 0.01 | 100 |

### 3.2 预训练影响分析

- **预训练模型平均准确率**: 91.06%
- **从头训练平均准确率**: 38.20%
- **性能提升**: 52.86个百分点
- **相对提升**: 138.4%

**分析结论**：
1. 预训练显著提升了模型性能，测试准确率提高了52.86个百分点
2. 预训练模型收敛速度更快，仅需3轮训练即可达到最佳性能
3. 从头训练虽然经过100轮训练，但性能仍远低于预训练模型
4. 预训练模型的训练效率是从头训练的33倍以上

### 3.3 最佳模型信息

- **模型**: ResNet-18
- **配置**: 预训练微调
- **测试准确率**: 91.06%
- **验证准确率**: 92.74%
- **训练轮数**: 3
- **模型权重文件**: demo_resnet18_quick_best.pth

## 4. 类别性能分析

### 4.1 表现最好的类别
1. **accordion**: F1=1.000 (支持样本:25)
2. **car side**: F1=1.000 (支持样本:93)
3. **dalmatian**: F1=1.000 (支持样本:37)
4. **okapi**: F1=1.000 (支持样本:9)
5. **pagoda**: F1=1.000 (支持样本:17)

### 4.2 表现最差的类别
1. **wheelchair**: F1=0.448 (支持样本:29)
2. **binocular**: F1=0.444 (支持样本:3)
3. **water lilly**: F1=0.343 (支持样本:7)
4. **inline skate**: F1=0.200 (支持样本:1)
5. **wild cat**: F1=0.121 (支持样本:4)

### 4.3 性能分析
- **完美分类类别**: 5个类别达到了100% F1分数
- **困难类别特征**: 表现差的类别通常具有样本数少、类间相似度高的特点
- **数据不平衡影响**: inline_skate类别仅有1个测试样本，严重影响了性能评估

## 5. TensorBoard可视化指南

### 5.1 启动TensorBoard
```bash
tensorboard --logdir runs
```
然后在浏览器中访问: http://localhost:6006

### 5.2 必需截图列表

#### 图1: 训练曲线对比
- **位置**: SCALARS页面
- **选择指标**: Loss_Comparison 和 Accuracy_Comparison
- **保存名称**: 图1-训练曲线.png
- **说明**: 显示训练/验证损失和准确率的变化趋势

#### 图2: 学习率调度曲线
- **位置**: SCALARS页面
- **选择指标**: Learning_Rate
- **保存名称**: 图2-学习率曲线.png
- **说明**: 展示学习率在训练过程中的变化

#### 图3: mAP指标曲线
- **位置**: SCALARS页面
- **选择指标**: Validation/Mean_Average_Metrics
- **保存名称**: 图3-mAP指标.png
- **说明**: 验证集综合性能指标（精确度+召回率+F1的平均值）

#### 图4: 超参数对比
- **位置**: HPARAMS页面
- **保存名称**: 图4-超参数对比.png
- **说明**: 不同实验配置的超参数和性能对比

### 5.3 图表说明模板
- **图1**: 训练曲线显示预训练模型在第3轮达到最佳性能，验证准确率从81.68%提升到92.74%
- **图2**: 学习率调度策略在第2轮后将学习率从0.001降至0.0001
- **图3**: 验证集综合指标稳定提升并在第3轮收敛
- **图4**: 预训练vs从头训练的性能差异明显

## 6. 模型权重文件

以下模型权重文件已保存在 `models/` 目录中：
- `demo_resnet18_quick_best.pth` (预训练微调最佳模型)
- `resnet18_from_scratch_best.pth` (从头训练最佳模型)

## 7. 结果文件说明

### 7.1 结果目录结构
```
results/
├── demo_resnet18_quick_results.json
├── resnet18_from_scratch_results.json
├── *_confusion_matrix.png
├── *_training_curves.png
├── comparison_results.csv
└── accuracy_comparison.png

runs/
└── [experiment_name]/  # TensorBoard日志
```

## 8. 代码运行记录

### 8.1 数据集分析
```bash
python main.py --analyze-only
```

### 8.2 完整实验运行
```bash
# 预训练微调
python demo.py

# 从头训练
python main.py --models resnet18 --experiments from_scratch
```

### 8.3 测试模型
```bash
python test.py --model-path models/demo_resnet18_quick_best.pth
```

## 9. 结论与讨论

### 9.1 主要发现
1. **预训练的重要性**: 预训练模型相比从头训练有显著优势
2. **训练效率**: 预训练模型仅需很少轮次即可达到高性能
3. **类别不平衡**: 测试样本数量差异巨大，影响模型评估

### 9.2 改进建议
1. 增加数据增强策略以提升小样本类别性能
2. 采用类别平衡损失函数处理数据不平衡问题
3. 尝试其他预训练模型架构(ResNet-50, DenseNet等)

---
